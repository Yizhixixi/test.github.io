---
layout: post
category: life
title: çµé­‚æ‹·é—®ï¼šequalså’ŒhashCodeæ˜¯è¿œæˆ¿äº²æˆšå—ï¼Ÿ
tagline: by æ²‰é»˜ç‹äºŒ
tags: 
  - java
---

åœ¨é€› programcreek çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€äº›ä¸“æ³¨ç»†èŠ‚ä½†ä»·å€¼è¿åŸçš„ä¸»é¢˜ã€‚æ¯”å¦‚è¯´ï¼šJava çš„ `equals()` å’Œ `hashCode()` æ˜¯è¿œæˆ¿äº²æˆšå—ï¼Ÿåƒè¿™ç±»çµé­‚æ‹·é—®çš„ä¸»é¢˜ï¼Œéå¸¸å€¼å¾—æ·±å…¥åœ°ç ”ç©¶ä¸€ä¸‹ã€‚

<!--more-->



å¦å¤–ï¼Œæˆ‘æƒ³è¦å‘Šè¯‰å¤§å®¶çš„æ˜¯ï¼Œç ”ç©¶çš„è¿‡ç¨‹éå¸¸çš„æœ‰è¶£ï¼Œå°±å¥½åƒåœ¨è¿·å®«é‡Œæ¢å®ä¸€æ ·ï¼Œèµ·åˆæœ‰äº›ä¸çŸ¥æ‰€æªï¼Œä½†ç»è¿‡ä¸€ç•ªç”¨å¿ƒçš„æ‘¸ç´¢åï¼Œä¸ä½†ä¼šæ‰¾åˆ°å®è—ï¼Œè¿˜ä¼šæœ‰ä¸€ç§èŒ…å¡é¡¿å¼€çš„æ„Ÿè§‰ï¼Œéå¸¸æ£’ã€‚

![](http://www.itwanger.com/assets/images/2020/02/java-equals-hascode-01.png)


å¯¹äºç»å¤§å¤šæ•°çš„åˆçº§ç¨‹åºå‘˜æˆ–è€…è¯´ä¸é‡è§†â€œå†…åŠŸâ€çš„è€é¸Ÿæ¥è¯´ï¼Œå¾€å¾€åœç•™åœ¨â€œçŸ¥å…¶ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶â€çš„å±‚é¢ä¸Šâ€”â€”ä¼šç”¨ï¼Œä½†è¦è¯´åº•å±‚çš„åŸç†ï¼Œå¯å°±åªèƒ½æŒ æŒ å¤´åŒæ‰‹ä¸€æ‘Šä¸€å¼ é—®å·è„¸äº†ã€‚

å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘ï¼Œæ²‰é»˜ç‹äºŒä¹Ÿä¸€ç›´å¤„äºè¿™ç§å±‚é¢ä¸Šã€‚ä½†æˆ‘å†³å®šæ”¹å˜äº†ï¼Œå› ä¸ºâ€œå†…åŠŸâ€å°±å¥½åƒæ˜¯åœ¨æ‰“åœ°åŸºï¼Œåªæœ‰æŠŠåœ°åŸºæ‰“å¥½äº†ï¼Œæ‰èƒ½ç›–èµ·ç»å¾—ä½è€ƒéªŒçš„é«˜æ¥¼å¤§å¦ã€‚å€Ÿæ­¤æœºä¼šï¼Œæˆ‘å°±å’Œå¤§å®¶ä¸€èµ·ï¼Œå¯¹â€œequals() å’Œ hashCode()â€è¿›è¡Œä¸€æ¬¡æ·±å…¥åœ°ç ”ç©¶ã€‚

`equals()` å’Œ `hashCode()` æ˜¯ Java çš„è¶…çº§ç¥–å…ˆç±» Object å®šä¹‰çš„ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼š

```java
public boolean equals(Object obj)
public int hashCode()
```

è®²é“ç†ï¼Œå•ä»æ–¹æ³•çš„å®šä¹‰ä¸Šæ¥çœ‹ï¼Œ`equals()` å’Œ `hashCode()` è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´æ²¡æœ‰ä»»ä½•äº²æˆšå…³ç³»ï¼Œè¿œæˆ¿éƒ½å¤Ÿä¸ä¸Šèµ„æ ¼ã€‚ä½†å¾€æ·±å¤„æ‰’æ‹‰ï¼Œå®ƒä»¬ä¹‹é—´è¿˜çœŸçš„æ˜¯æœ‰åƒä¸ä¸‡ç¼•çš„å…³ç³»ã€‚åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå¦‚æœå¤§å®¶ä¼™æ¯”è¾ƒæ„Ÿå…´è¶£çš„è¯ï¼Œå°±è¯·éšæˆ‘æ¥ï¼Œæ‰“æ€ªè¿›é˜¶å–½ï¼

### 01ã€equals()

ä¸ºäº†å‹¾èµ·å¤§å®¶çš„å¥½å¥‡å¿ƒï¼Œæˆ‘ç‰¹æ„ç¼–å†™äº†ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚

```java
public class Cmower {
    private String name;

    public Cmower(String name) {
        this.name = name;
    }

    @Override
    public boolean equals(Object obj) {
        if (obj == null) return false;
        if (!(obj instanceof Cmower))
            return false;
        if (obj == this)
            return true;
        return this.name.equals(((Cmower) obj).name);
    }

    public static void main(String[] args) {
        Cmower a1 = new Cmower("æ²‰é»˜ç‹äºŒ");
        Cmower a2 = new Cmower("æ²‰é»˜ç‹ä¸‰");

        Map<Cmower, Integer> m = new HashMap<Cmower, Integer>();
        m.put(a1, 18);
        m.put(a2, 28);
        System.out.println(m.get(new Cmower("æ²‰é»˜ç‹äºŒ")));
    }
}
```

æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Cmower ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªå­—æ®µ nameï¼›ç„¶åæˆ‘ä»¬é‡å†™äº† `equals()` æ–¹æ³•ï¼š

1ï¼‰å¦‚æœæŒ‡å®šå¯¹è±¡ä¸º nullï¼Œè¿”å› falseï¼›

2ï¼‰å¦‚æœæŒ‡å®šå¯¹è±¡çš„ç±»å‹ä¸æ˜¯ Cmower ç±»ï¼Œè¿”å› falseï¼›

3ï¼‰å¦‚æœæŒ‡å®šå¯¹è±¡â€œ==â€å½“å‰å¯¹è±¡ï¼Œè¿”å› trueï¼›

4ï¼‰å¦‚æœæŒ‡å®šå¯¹è±¡çš„ name å’Œå½“å‰å¯¹è±¡çš„ name ç›¸ç­‰ï¼Œè¿”å› trueï¼›æ„å‘³ç€åªè¦ name ç›¸ç­‰ï¼Œä¸¤ä¸ªå¯¹è±¡å°±æ˜¯ equals çš„ã€‚

åœ¨ main æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ª Cmower ç±»å‹çš„å¯¹è±¡ï¼Œname åˆ†åˆ«ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€å’Œâ€œæ²‰é»˜ç‹ä¸‰â€ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºé”®æ”¾å…¥äº† HashMap å½“ä¸­ï¼›æŒ‰ç†è¯´ï¼Œåªè¦é”®çš„ name ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€ï¼Œç¨‹åºå°±åº”è¯¥èƒ½å¤Ÿè·å–æˆ‘ä»¬ä¹‹å‰æ”¾å…¥çš„ Cmower å¯¹è±¡ã€‚ä½†ç»“æœå´â€œå‡ºäººæ„æ–™â€ï¼š

```
null
```

å¯æ˜æ˜ HashMap ä¸­æ”¾å…¥äº†â€œæ²‰é»˜ç‹äºŒâ€å•Šï¼Œdebug ä¹Ÿå¯ä»¥è¯æ˜è¿™ä¸€ç‚¹ã€‚

![](http://www.itwanger.com/assets/images/2020/02/java-equals-hascode-02.png)


é‚£ç©¶ç«Ÿæ˜¯å“ªé‡Œå‡ºäº†é”™å‘¢ï¼Ÿ

### 02ã€hashCode()

å¼€é—¨è§å±±åœ°è¯´å§ï¼Œé—®é¢˜å‡ºåœ¨ `hashCode()` èº«ä¸Šï¼ŒCmower ç±»æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•ã€‚å€Ÿæ­¤æœºä¼šäº¤ä»£ä¸€ä¸‹ `equals()` å’Œ `hashCode()` è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´çš„å…³ç³»å§ï¼š

1ï¼‰å¦‚æœä¸¤ä¸ªå¯¹è±¡éœ€è¦ç›¸ç­‰ï¼ˆequalsï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬å¿…é¡»æœ‰ç€ç›¸åŒçš„å“ˆå¸Œç ï¼ˆhashCodeï¼‰ï¼›

2ï¼‰ä½†å¦‚æœä¸¤ä¸ªå¯¹è±¡æœ‰ç€ç›¸åŒçš„å“ˆå¸Œç ï¼Œå®ƒä»¬å´ä¸ä¸€å®šç›¸ç­‰ã€‚

è¿™å°±å¥½åƒåœ¨è¯´ï¼šä½ å’Œä½ å¯¹è±¡è¦æƒ³åœ¨ä¸€èµ·å¤©é•¿åœ°ä¹…ï¼Œå°±å¿…é¡»å½¼æ­¤ç›¸çˆ±ï¼›ä½†å³ä¾¿ä½ å’Œä½ å¯¹è±¡å½¼æ­¤ç›¸çˆ±ï¼Œä½†å´ä¸ä¸€å®šçœŸçš„èƒ½åœ¨ä¸€èµ·ã€‚

ï¼ˆæ‰å¿ƒäº†ï¼Œè€é“ï¼‰

HashMap ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ›´å¿«åœ°é€šè¿‡é”®è·å–å¯¹åº”çš„å€¼ï¼Œæ˜¯å› ä¸ºå®ƒçš„é”®ä½ä¸Šä½¿ç”¨äº†å“ˆå¸Œç ã€‚å½“æˆ‘ä»¬éœ€è¦ä» HashMap ä¸­è·å–ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠé”®è½¬æˆä¸€ä¸ªå“ˆå¸Œç ï¼Œåˆ¤æ–­å€¼æ‰€åœ¨çš„ä½ç½®ï¼›ç„¶ååœ¨ä½¿ç”¨â€œ==â€æ“ä½œç¬¦æˆ–è€… `equals()` æ–¹æ³•æ¯”è¾ƒé”®ä½æ˜¯å¦ç›¸ç­‰ï¼Œä»è€Œå–å‡ºé”®ä½ä¸Šçš„å€¼ã€‚

å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ HashMap ç±»çš„ `get()` æ–¹æ³•çš„æºç ã€‚

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}

public V get(Object key) {
    Node<K,V> e;
    return (e = getNode(hash(key), key)) == null ? null : e.value;
}

final Node<K,V> getNode(int hash, Object key) {
    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;
    if ((tab = table) != null && (n = tab.length) > 0 &&
            (first = tab[(n - 1) & hash]) != null) {
        if (first.hash == hash && // always check first node
                ((k = first.key) == key || (key != null && key.equals(k))))
            return first;
        if ((e = first.next) != null) {
            if (first instanceof TreeNode)
                return ((TreeNode<K,V>)first).getTreeNode(hash, key);
            do {
                if (e.hash == hash &&
                        ((k = e.key) == key || (key != null && key.equals(k))))
                    return e;
            } while ((e = e.next) != null);
        }
    }
    return null;
}
```

åœ¨ä¸Šä¾‹ä¸­ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ä» HashMap ä¸­å–å‡º name ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€çš„ Cmower å¯¹è±¡ï¼Œå°±æ˜¯å› ä¸º put çš„æ—¶å€™å’Œ get çš„æ—¶å€™ä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œç ä¸åŒçš„åŸå› é€ æˆçš„ã€‚

æ˜ç™½äº†åŸå› ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ Cmower ç±»è¿›è¡Œæ”¹é€ ï¼Œæ¥çœ‹é‡å†™åçš„ `hashCode()` å§ã€‚

```java
@Override
public int hashCode() {
    return this.name.hashCode();
}
```

é‡å†™åçš„ `hashCode()` æ–¹æ³•ä½“éå¸¸ç®€å•ï¼šè¿”å› name å­—æ®µçš„å“ˆå¸Œç ã€‚è¿™æ ·çš„è¯ï¼Œput å’Œ get ç”¨åˆ°çš„å“ˆå¸Œç å°±æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€çš„å“ˆå¸Œç æ˜¯ 867758096ã€‚å†æ¬¡è¿è¡Œç¨‹åºï¼Œä½ å°±ä¼šå‘ç°è¾“å‡ºç»“æœä¸å†æ˜¯ null è€Œæ˜¯ 18 äº†ã€‚



### 03ã€å°ç»“

1ï¼‰`equals()` çš„ä½œç”¨æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚

2ï¼‰`hashCode()` çš„ä½œç”¨æ˜¯è·å–å¯¹è±¡çš„å“ˆå¸Œç ï¼›å“ˆå¸Œç ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨æ¥ç¡®å®šå¯¹è±¡åœ¨å“ˆå¸Œè¡¨ï¼ˆæ¯”å¦‚ HashMapï¼‰ä¸­çš„ç´¢å¼•ä½ç½®ã€‚

æ‹¿ HashMap æ¥è¯´ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ã€‚å½“æˆ‘ä»¬è¦è·å–æŸä¸ªâ€œå€¼â€æ—¶ï¼Œå®é™…ä¸Šæ˜¯è¦è·å–æ•°ç»„ä¸­çš„æŸä¸ªä½ç½®çš„å…ƒç´ ã€‚è€Œæ•°ç»„çš„ä½ç½®ï¼Œå°±æ˜¯é€šè¿‡â€œé”®â€æ¥è·å–çš„ï¼›æ›´è¿›ä¸€æ­¥è¯´ï¼Œæ˜¯é€šè¿‡â€œé”®â€å¯¹åº”çš„[å“ˆå¸Œç ](http://www.itwanger.com/java/2019/11/08/java-hashmap.html)è®¡ç®—å¾—åˆ°çš„ã€‚

3ï¼‰å¦‚æœä¸¤ä¸ªå¯¹è±¡éœ€è¦ç›¸ç­‰ï¼ˆequalsï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬å¿…é¡»æœ‰ç€ç›¸åŒçš„å“ˆå¸Œç ï¼ˆhashCodeï¼‰ï¼›

4ï¼‰ä½†å¦‚æœä¸¤ä¸ªå¯¹è±¡æœ‰ç€ç›¸åŒçš„å“ˆå¸Œç ï¼Œå®ƒä»¬å´ä¸ä¸€å®šç›¸ç­‰ã€‚

æ¥å¯¹ç…§ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„å…³äº `equals()` å’Œ `hashCode()` çš„è§£é‡Šï¼š

*   If two objects are equal according to theÂ `equals(Object)`Â method, then calling theÂ `hashCode`Â method on each of the two objects must produce the same integer result.
*   It isÂ *not*Â required that if two objects are unequal according to theÂ `equals(java.lang.Object)`Â method, then calling theÂ `hashCode`Â method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hash tables.

å¯èƒ½æœ‰è¯»è€…ä¼šé—®ï¼šâ€œä¸€å®šè¦åŒæ—¶é‡å†™ `equals()` å’Œ `hashCode()` å—ï¼Ÿâ€

å›ç­”å½“ç„¶æ˜¯å¦å®šçš„ã€‚å¦‚æœå¯¹è±¡ä½œä¸ºé”®åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–¹æ³•éƒ½è¦é‡å†™ï¼Œå› ä¸º put å’Œ get çš„æ—¶å€™éœ€è¦ç”¨åˆ°å“ˆå¸Œç å’Œ `equals()` æ–¹æ³•ï¼›

å¦‚æœå¯¹è±¡ä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œä»…ç”¨æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œé‚£ä¹ˆé‡å†™ `equals()` å°±è¡Œäº†ã€‚

å˜¿å˜¿ğŸ˜œï¼Œè¿™ä¸‹ææ¸…æ¥š `equals()` å’Œ `hashCode()` ä¹‹é—´çš„å…³ç³»äº†å§ï¼

### 04ã€é¸£è°¢


å¥½äº†ï¼Œè¯»è€…æœ‹å‹ä»¬ï¼Œä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†ã€‚èƒ½çœ‹åˆ°è¿™é‡Œçš„éƒ½æ˜¯æœ€ä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œå‡èŒåŠ è–ªå°±æ˜¯ä½ äº†ğŸ‘ã€‚**åŸåˆ›ä¸æ˜“ï¼Œå¦‚æœè§‰å¾—æœ‰ç‚¹ç”¨çš„è¯ï¼Œè¯·ä¸è¦åå•¬ä½ æ‰‹ä¸­ç‚¹èµçš„æƒåŠ›â€”â€”å› ä¸ºè¿™å°†æ˜¯æˆ‘å†™ä½œçš„æœ€å¼ºåŠ¨åŠ›**ã€‚

![](http://www.itwanger.com/assets/images/cmower_4.png)














