---
layout: post
category: java
title: Javaç¨‹åºå‘˜å€¼å¾—æ‹¥æœ‰çš„TreeMapæŒ‡å—
tagline: by æ²‰é»˜ç‹äºŒ
tags: 
  - java
---

>å…ˆçœ‹å†ç‚¹èµï¼Œç»™è‡ªå·±ä¸€ç‚¹æ€è€ƒçš„æ—¶é—´ï¼Œå¾®ä¿¡æœç´¢ã€**æ²‰é»˜ç‹äºŒ**ã€‘å…³æ³¨è¿™ä¸ªæœ‰é¢œå€¼å´å‡è£…é æ‰åè‹Ÿä¸”çš„ç¨‹åºå‘˜ã€‚
>æœ¬æ–‡Â **GitHub**Â [github.com/itwanger](https://github.com/itwanger/itwanger.github.io)Â å·²æ”¶å½•ï¼Œé‡Œé¢è¿˜æœ‰æˆ‘ç²¾å¿ƒä¸ºä½ å‡†å¤‡çš„ä¸€çº¿å¤§å‚é¢è¯•é¢˜ã€‚

<!--more-->


åƒé¥­é—´éš™ï¼Œè¿·ä¸Šäº†ã€Šåæ§½å¤§ä¼šã€‹ï¼Œä¸€é›†ä¸€é›†åœ°åˆ·å•Šï¼Œè§‰å¾—è¿™äº›å˜‰å®¾çœŸçš„æŒºæœ‰å‹‡æ°”çš„ï¼Œæ•¢äºç›´é¢è‡ªå·±çš„æƒ¨æ·¡æ§½ç‚¹ã€‚äºæ˜¯ï¼ŒåŒå­¦ä»¬çœ‹åˆ°äº†ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªæŠ€æœ¯åšä¸»ï¼Œä¹Ÿå—åˆ°äº†â€œä¼ æŸ“â€ï¼Œä¸ï¼Œå—åˆ°äº†â€œç†é™¶â€ï¼Œæœ¬æ¥è¿™ç¯‡æ–‡ç« æ ‡é¢˜å°±æƒ³å«ã€ŠTreeMap æŒ‡å—ã€‹ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å¹³æ·¡æ— å¥‡ï¼Œæ²¡æœ‰æ§½ç‚¹ï¼Ÿäºæ˜¯æˆ‘å°±æƒ³ï¼Œä¸å¦¨è¹­ç‚¹åæ§½å¤§ä¼šçš„çƒ­åº¦å§ï¼Œè™½ç„¶åæ§½å¤§ä¼šç°åœ¨ä¹Ÿæ²¡ä»€ä¹ˆçƒ­åº¦äº†å“ˆã€‚

TreeMapï¼Œè™½ç„¶ä¹Ÿæ˜¯ä¸ª Mapï¼Œä½†å­˜åœ¨æ„Ÿå¤ªä½äº†ã€‚æˆ‘åšç¨‹åºå‘˜è¿™åå¤šå¹´é‡Œï¼ŒHashMap ç”¨äº†è¶…è¿‡åå¹´ï¼ŒTreeMap åªç”¨äº†å¤šå­—é‡Œé‚£ä¹ˆä¸€å°ä¼šå„¿ä¸€å°ä¼šå„¿ï¼ŒçœŸçš„æ˜¯ï¼Œå¤ªæƒ¨äº†ã€‚

è™½ç„¶ TreeMap ç”¨å¾—å°‘ï¼Œä½†è¿˜æ˜¯æœ‰ç”¨å¤„çš„ã€‚

ä¹‹å‰ [LinkedHashMap](https://mp.weixin.qq.com/s/yI6mMIjddKnAOjOfwzjlXw) é‚£ç¯‡æ–‡ç« é‡Œæåˆ°è¿‡äº†ï¼ŒHashMap æ˜¯æ— åºçš„ï¼Œæ‰€æœ‰æœ‰äº† LinkedHashMapï¼ŒåŠ ä¸Šäº†åŒå‘é“¾è¡¨åï¼Œå°±å¯ä»¥ä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåºå’Œè®¿é—®é¡ºåºï¼Œé‚£ TreeMap å‘¢ï¼Ÿ

TreeMap ç”±çº¢é»‘æ ‘å®ç°ï¼Œå¯ä»¥ä¿æŒå…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œæˆ–è€…å®ç°äº† Comparator æ¥å£çš„è‡ªå®šä¹‰é¡ºåºã€‚

å¯èƒ½æœ‰äº›åŒå­¦ä¸çŸ¥é“çº¢é»‘æ ‘ï¼Œç†è§£èµ·æ¥ TreeMap å°±æœ‰ç‚¹éš¾åº¦ï¼Œé‚£æˆ‘å…ˆæ¥æ™®åŠä¸€ä¸‹ï¼š

>çº¢é»‘æ ‘ï¼ˆè‹±è¯­ï¼šRedâ€“black treeï¼‰æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œç»“æ„å¤æ‚ï¼Œä½†å´æœ‰ç€è‰¯å¥½çš„æ€§èƒ½ï¼Œå®ŒæˆæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦å‡ä¸º log(n)ã€‚

äºŒå‰æŸ¥æ‰¾æ ‘åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

![](http://www.itwanger.com/assets/images/2020/08/java-treemap-01.png)

ä¸Šå›¾ä¸­è¿™æ£µæ ‘ï¼Œå°±æ˜¯ä¸€é¢—å…¸å‹çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š

1ï¼‰å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚

2ï¼‰å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚

3ï¼‰å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ã€‚

ç†è§£äºŒå‰æŸ¥æ‰¾æ ‘äº†å§ï¼Ÿä¸è¿‡ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æœ‰ä¸€ä¸ªä¸è¶³ï¼Œå°±æ˜¯å®¹æ˜“å˜æˆç˜¸å­ï¼Œå°±æ˜¯ä¸€ä¾§å¤šï¼Œä¸€ä¾§å°‘ï¼Œå°±åƒä¸‹å›¾è¿™æ ·ï¼š

![](http://www.itwanger.com/assets/images/2020/08/java-treemap-02.png)

æŸ¥æ‰¾çš„æ•ˆç‡å°±è¦ä» log(n) å˜æˆ o(n) äº†ï¼Œå¯¹å§ï¼Ÿå¿…é¡»è¦å¹³è¡¡ä¸€ä¸‹ï¼Œå¯¹å§ï¼Ÿäºæ˜¯å°±æœ‰äº†å¹³è¡¡äºŒå‰æ ‘ï¼Œå·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ï¼Œå°±åƒä¸‹å›¾è¿™æ ·ï¼š

![](http://www.itwanger.com/assets/images/2020/08/java-treemap-03.png)

çº¢é»‘æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒé€šè¿‡é¢œè‰²çš„çº¦æŸæ¥ç»´æŒç€äºŒå‰æ ‘çš„å¹³è¡¡ï¼š

1ï¼‰æ¯ä¸ªèŠ‚ç‚¹éƒ½åªèƒ½æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²

2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²

3ï¼‰æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„ã€‚

4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€æ¡è·¯å¾„ä¸Šä¸èƒ½å‡ºç°ç›¸é‚»çš„ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ã€‚

5ï¼‰ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚

![](http://www.itwanger.com/assets/images/2020/08/java-treemap-04.png)

é‚£ï¼Œå…³äºçº¢é»‘æ ‘ï¼ŒåŒå­¦ä»¬å°±å…ˆäº†è§£åˆ°è¿™ï¼Œè„‘å­é‡Œæœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼ŒçŸ¥é“ TreeMap æ˜¯ä¸ªä»€ä¹ˆç©æ„ã€‚

### 01ã€è‡ªç„¶é¡ºåº

é»˜è®¤æƒ…å†µä¸‹ï¼ŒTreeMap æ˜¯æ ¹æ® key çš„è‡ªç„¶é¡ºåºæ’åˆ—çš„ã€‚æ¯”å¦‚è¯´æ•´æ•°ï¼Œå°±æ˜¯å‡åºï¼Œ1ã€2ã€3ã€4ã€5ã€‚

```java
TreeMap<Integer,String> mapInt = new TreeMap<>();
mapInt.put(3, "æ²‰é»˜ç‹äºŒ");
mapInt.put(2, "æ²‰é»˜ç‹äºŒ");
mapInt.put(1, "æ²‰é»˜ç‹äºŒ");
mapInt.put(5, "æ²‰é»˜ç‹äºŒ");
mapInt.put(4, "æ²‰é»˜ç‹äºŒ");

System.out.println(mapInt);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{1=æ²‰é»˜ç‹äºŒ, 2=æ²‰é»˜ç‹äºŒ, 3=æ²‰é»˜ç‹äºŒ, 4=æ²‰é»˜ç‹äºŒ, 5=æ²‰é»˜ç‹äºŒ}
```

TreeMap æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæƒ³ä¸€æ¢ç©¶ç«Ÿï¼Œå°±å¾—ä¸Šæºç äº†ï¼Œæ¥çœ‹ TreeMap çš„ `put()` æ–¹æ³•ï¼ˆçœå»äº†ä¸€éƒ¨åˆ†ï¼Œç‰ˆæœ¬ä¸º JDK 14ï¼‰ï¼š

```java
public V put(K key, V value) {
    TreeMap.Entry<K,V> t = root;
    int cmp;
    TreeMap.Entry<K,V> parent;
    // split comparator and comparable paths
    Comparator<? super K> cpr = comparator;
    if (cpr != null) {
    }
    else {
        @SuppressWarnings("unchecked")
        Comparable<? super K> k = (Comparable<? super K>) key;
        do {
            parent = t;
            cmp = k.compareTo(t.key);
            if (cmp < 0)
                t = t.left;
            else if (cmp > 0)
                t = t.right;
            else
                return t.setValue(value);
        } while (t != null);
    }
    return null;
}
```

æ³¨æ„ `cmp = k.compareTo(t.key)` è¿™è¡Œä»£ç ï¼Œå°±æ˜¯ç”¨æ¥è¿›è¡Œ key çš„æ¯”è¾ƒçš„ï¼Œç”±äºæ­¤æ—¶ key æ˜¯ intï¼Œæ‰€ä»¥å°±ä¼šè°ƒç”¨ Integer ç±»çš„ `compareTo()` æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚

```java
public int compareTo(Integer anotherInteger) {
    return compare(this.value, anotherInteger.value);
}

public static int compare(int x, int y) {
    return (x < y) ? -1 : ((x == y) ? 0 : 1);
}
```

é‚£ç›¸åº”çš„ï¼Œå¦‚æœ key æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œä¹Ÿå°±ä¼šè°ƒç”¨ String ç±»çš„ `compareTo()` æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚

```java
public int compareTo(String anotherString) {
    byte v1[] = value;
    byte v2[] = anotherString.value;
    byte coder = coder();
    if (coder == anotherString.coder()) {
        return coder == LATIN1 ? StringLatin1.compareTo(v1, v2)
                : StringUTF16.compareTo(v1, v2);
    }
    return coder == LATIN1 ? StringLatin1.compareToUTF16(v1, v2)
            : StringUTF16.compareToLatin1(v1, v2);
}
```

ç”±äºå†…éƒ¨æ˜¯ç”±å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„çš„å­—ç¬¦è¿›è¡Œæ¯”è¾ƒçš„ï¼Œæ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç»•ï¼Ÿå¯¹ï¼Œå°±æ˜¯å¾ˆç»•ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²ä½œä¸º key çš„è¯ï¼Œçœ‹ä¸å‡ºæ¥æ•ˆæœã€‚

```java
TreeMap<String,String> mapString = new TreeMap<>();
mapString.put("c", "æ²‰é»˜ç‹äºŒ");
mapString.put("b", "æ²‰é»˜ç‹äºŒ");
mapString.put("a", "æ²‰é»˜ç‹äºŒ");
mapString.put("e", "æ²‰é»˜ç‹äºŒ");
mapString.put("d", "æ²‰é»˜ç‹äºŒ");

System.out.println(mapString);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{a=æ²‰é»˜ç‹äºŒ, b=æ²‰é»˜ç‹äºŒ, c=æ²‰é»˜ç‹äºŒ, d=æ²‰é»˜ç‹äºŒ, e=æ²‰é»˜ç‹äºŒ}
```

å­—æ¯çš„å‡åºï¼Œå¯¹å§ï¼Ÿ

### 02ã€è‡ªå®šä¹‰æ’åº

å¦‚æœè‡ªç„¶é¡ºåºä¸æ»¡è¶³ï¼Œé‚£å°±å¯ä»¥åœ¨å£°æ˜ TreeMap å¯¹è±¡çš„æ—¶å€™æŒ‡å®šæ’åºè§„åˆ™ã€‚

```java
TreeMap<Integer,String> mapIntReverse = new TreeMap<>(Comparator.reverseOrder());
mapIntReverse.put(3, "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(2, "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(1, "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(5, "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(4, "æ²‰é»˜ç‹äºŒ");

System.out.println(mapIntReverse);
```

TreeMap æä¾›äº†å¯ä»¥æŒ‡å®šæ’åºè§„åˆ™çš„æ„é€ æ–¹æ³•ï¼š

```java
public TreeMap(Comparator<? super K> comparator) {
    this.comparator = comparator;
}
```

`Comparator.reverseOrder()` è¿”å›çš„æ˜¯ ReverseComparator å¯¹è±¡ï¼Œå°±æ˜¯ç”¨æ¥åè½¬é¡ºåºçš„ï¼Œéå¸¸æ–¹ä¾¿ã€‚

æ‰€ä»¥ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{5=æ²‰é»˜ç‹äºŒ, 4=æ²‰é»˜ç‹äºŒ, 3=æ²‰é»˜ç‹äºŒ, 2=æ²‰é»˜ç‹äºŒ, 1=æ²‰é»˜ç‹äºŒ}
```

HashMap æ˜¯æ— åºçš„ï¼Œæ’å…¥çš„é¡ºåºéšç€å…ƒç´ çš„å¢åŠ ä¼šä¸åœåœ°å˜åŠ¨ã€‚ä½† TreeMap èƒ½å¤Ÿè‡³å§‹è‡³ç»ˆæŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ’åˆ—ï¼Œè¿™å¯¹äºéœ€è¦è‡ªå®šä¹‰æ’åºçš„åœºæ™¯ï¼Œå®åœ¨æ˜¯å¤ªæœ‰ç”¨äº†ï¼

### 03ã€æ’åºçš„å¥½å¤„

æ—¢ç„¶ TreeMap çš„å…ƒç´ æ˜¯ç»è¿‡æ’åºçš„ï¼Œé‚£æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªï¼Œæœ€å°çš„é‚£ä¸ªï¼Œæˆ–è€…æ‰¾å‡ºæ‰€æœ‰å¤§äºæˆ–è€…å°äºæŸä¸ªå€¼çš„é”®æ¥è¯´ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚

```java
Integer highestKey = mapInt.lastKey();
Integer lowestKey = mapInt.firstKey();
Set<Integer> keysLessThan3 = mapInt.headMap(3).keySet();
Set<Integer> keysGreaterThanEqTo3 = mapInt.tailMap(3).keySet();

System.out.println(highestKey);
System.out.println(lowestKey);

System.out.println(keysLessThan3);
System.out.println(keysGreaterThanEqTo3);
```

TreeMap è€ƒè™‘å¾—å¾ˆå‘¨å…¨ï¼Œæ°å¥½å°±æä¾›äº† `lastKey()`ã€`firstKey()` è¿™æ ·è·å–æœ€åä¸€ä¸ª key å’Œç¬¬ä¸€ä¸ª key çš„æ–¹æ³•ã€‚

`headMap()` è·å–çš„æ˜¯åˆ°æŒ‡å®š key ä¹‹å‰çš„ keyï¼›`tailMap()` è·å–çš„æ˜¯æŒ‡å®š key ä¹‹åçš„ keyï¼ˆåŒ…æ‹¬æŒ‡å®š keyï¼‰ã€‚

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
5
1
[1, 2]
[3, 4, 5]
```

### 04ã€å¦‚ä½•é€‰æ‹© Map

åœ¨å­¦ä¹  TreeMap ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº† [HashMap](https://mp.weixin.qq.com/s/VLf3bNKB_s2CImsVItxuRw) å’Œ [LinkedHashMap](https://mp.weixin.qq.com/s/yI6mMIjddKnAOjOfwzjlXw) ï¼Œé‚£å¦‚ä½•ä»å®ƒä»¬ä¸‰ä¸ªä¸­é—´é€‰æ‹©å‘¢ï¼Ÿ

HashMapã€LinkedHashMapã€TreeMap éƒ½å®ç°äº† Map æ¥å£ï¼Œå¹¶æä¾›äº†å‡ ä¹ç›¸åŒçš„åŠŸèƒ½ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚å®ƒä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«å°±åœ¨äºå…ƒç´ çš„é¡ºåºï¼š

HashMap å®Œå…¨ä¸ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œæ·»åŠ äº†æ–°çš„å…ƒç´ ï¼Œä¹‹å‰çš„é¡ºåºå¯èƒ½å®Œå…¨é€†è½¬ã€‚

LinkedHashMap é»˜è®¤ä¼šä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåºã€‚

TreeMap é»˜è®¤ä¼šä¿æŒ key çš„è‡ªç„¶é¡ºåºï¼ˆæ ¹æ® `compareTo()` æ–¹æ³•ï¼‰ã€‚

æ¥ä¸ªè¡¨æ ¼å§ï¼Œä¸€ç›®äº†ç„¶ã€‚

![](http://www.itwanger.com/assets/images/2020/08/java-treemap-05.png)

è°¢è°¢å¤§å®¶ï¼Œä¸‹æœŸè§ï¼ŒåŒå­¦ä»¬ã€‚

-----

æˆ‘æ˜¯æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰é¢œå€¼å´å‡è£…é æ‰åè‹Ÿä¸”çš„ç¨‹åºå‘˜ã€‚**å…³æ³¨å³å¯æå‡å­¦ä¹ æ•ˆç‡ï¼Œåˆ«å¿˜äº†ä¸‰è¿å•Šï¼Œç‚¹èµã€æ”¶è—ã€ç•™è¨€ï¼Œæˆ‘ä¸æŒ‘ï¼Œå¥¥åˆ©ç»™ğŸŒ¹**ã€‚

æ³¨ï¼šå¦‚æœæ–‡ç« æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æ¯«ä¸ç•™æƒ…åœ°æŒ‡æ­£ã€‚

å¦‚æœä½ è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰äº›å¸®åŠ©ï¼Œæ¬¢è¿å¾®ä¿¡æœç´¢ã€Œ**æ²‰é»˜ç‹äºŒ**ã€ç¬¬ä¸€æ—¶é—´é˜…è¯»ï¼Œå›å¤å…³é”®å­—ã€Œ**å°ç™½**ã€å¯ä»¥å…è´¹è·å–æˆ‘è‚äº† 4 ä¸‡+å­—çš„ ã€ŠJava å°ç™½ä»å…¥é—¨åˆ°æ”¾è‚†ã€‹2.0 ç‰ˆï¼›æœ¬æ–‡Â **GitHub**Â [github.com/itwanger](https://github.com/itwanger/itwanger.github.io)Â å·²æ”¶å½•ï¼Œæ¬¢è¿ starã€‚