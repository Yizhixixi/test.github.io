---
layout: post
category: java
title: å¬è¯´åŒå­¦ä½ æä¸æ‡‚Javaçš„LinkedHashMapï¼Œå¯ç¬‘
tagline: by æ²‰é»˜ç‹äºŒ
tags: 
  - java
---

>å…ˆçœ‹å†ç‚¹èµï¼Œç»™è‡ªå·±ä¸€ç‚¹æ€è€ƒçš„æ—¶é—´ï¼Œå¾®ä¿¡æœç´¢ã€**æ²‰é»˜ç‹äºŒ**ã€‘å…³æ³¨è¿™ä¸ªæœ‰é¢œå€¼å´å‡è£…é æ‰åè‹Ÿä¸”çš„ç¨‹åºå‘˜ã€‚
>æœ¬æ–‡Â **GitHub**Â [github.com/itwanger](https://github.com/itwanger/itwanger.github.io)Â å·²æ”¶å½•ï¼Œé‡Œé¢è¿˜æœ‰æˆ‘ç²¾å¿ƒä¸ºä½ å‡†å¤‡çš„ä¸€çº¿å¤§å‚é¢è¯•é¢˜ã€‚

<!--more-->




åŒå­¦ä»¬å¥½å•Šï¼Œè¿˜è®°å¾— [HashMap](https://mp.weixin.qq.com/s/VLf3bNKB_s2CImsVItxuRw) é‚£ç¯‡å—ï¼Ÿæˆ‘è‡ªå·±æ„Ÿè§‰å†™å¾—éå¸¸æ£’å•Šï¼Œæ—¢é€šä¿—æ˜“æ‡‚ï¼Œåˆæ·±å…¥æºç ï¼ŒçœŸçš„æ˜¯åˆ†æå¾—é€é€å½»å½»ã€æ¸…æ¸…æ¥šæ¥šã€æ˜æ˜ç™½ç™½çš„ã€‚ï¼ˆä¸€ä¸å°å¿ƒåˆä¸Šä»¨æˆè¯­ï¼Ÿï¼‰HashMap å“ªå“ªéƒ½å¥½ï¼ŒçœŸçš„ï¼Œåªè¦ä½ æƒ³ç”¨é”®å€¼å¯¹ï¼Œç¬¬ä¸€æ—¶é—´å°±åº”è¯¥æƒ³åˆ°å®ƒã€‚

ä½†ä¿—è¯è¯´äº†ï¼Œâ€œé‡‘æ— è¶³èµ¤äººæ— å®Œäººâ€ï¼ŒHashMap ä¹Ÿä¸ä¾‹å¤–ã€‚æœ‰ä¸€ç§éœ€æ±‚å®ƒå°±æ»¡è¶³ä¸äº†ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‰ç…§æ’å…¥é¡ºåºæ¥æ’åˆ—çš„é”®å€¼å¯¹é›†åˆï¼Œé‚£ HashMap å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚å› ä¸ºä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼ŒHashMap åœ¨æ’å…¥çš„æ—¶å€™å¯¹é”®åšäº†ä¸€æ¬¡å“ˆå¸Œç®—æ³•ï¼Œè¿™å°±å¯¼è‡´æ’å…¥çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚

å¯¹è¿™ä¸€ç‚¹è¿˜ä¸å¤ªæ˜ç™½çš„åŒå­¦ï¼Œå¯ä»¥å†å›åˆ° [HashMap](https://mp.weixin.qq.com/s/VLf3bNKB_s2CImsVItxuRw) é‚£ä¸€ç¯‡ï¼Œçœ‹çœ‹æˆ‘å¯¹ `put()` æ–¹æ³•çš„è®²è§£ã€‚

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    HashMap.Node<K,V>[] tab; HashMap.Node<K,V> p; int n, i;
    // â‘ ã€æ•°ç»„ table ä¸º null æ—¶ï¼Œè°ƒç”¨ resize æ–¹æ³•åˆ›å»ºé»˜è®¤å¤§å°çš„æ•°ç»„
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    // â‘¡ã€è®¡ç®—ä¸‹æ ‡ï¼Œå¦‚æœè¯¥ä½ç½®ä¸Šæ²¡æœ‰å€¼ï¼Œåˆ™å¡«å……
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
}
```

è¿™ä¸ªå…¬å¼ `i = (n - 1) & hash` è®¡ç®—åçš„å€¼å¹¶ä¸æ˜¯æŒ‰ç…§ 0ã€1ã€2ã€3ã€4ã€5 è¿™æ ·æœ‰åºçš„ä¸‹æ ‡å°†é”®å€¼å¯¹æ’å…¥åˆ°æ•°ç»„å½“ä¸­çš„ï¼Œè€Œæ˜¯æœ‰ä¸€å®šçš„éšæœºæ€§ã€‚

é‚£ LinkedHashMap å°±æ˜¯ä¸ºè¿™ä¸ªéœ€æ±‚åº”è¿è€Œç”Ÿçš„ã€‚LinkedHashMap ç»§æ‰¿äº† HashMapï¼Œæ‰€ä»¥ HashMap æœ‰çš„å…³äºé”®å€¼å¯¹çš„åŠŸèƒ½ï¼Œå®ƒä¹Ÿæœ‰äº†ã€‚

```java
public class LinkedHashMap<K,V>
    extends HashMap<K,V>
    implements Map<K,V>{}
```

æ­¤å¤–ï¼ŒLinkedHashMap å†…éƒ¨åˆè¿½åŠ äº†åŒå‘é“¾è¡¨ï¼Œæ¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚æ³¨æ„ä¸‹é¢ä»£ç ä¸­çš„ before å’Œ afterï¼Œå®ƒä¿©å°±æ˜¯ç”¨æ¥ç»´æŠ¤å½“å‰å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ çš„é¡ºåºçš„ã€‚

```java
static class Entry<K,V> extends HashMap.Node<K,V> {
    LinkedHashMap.Entry<K,V> before, after;
    Entry(int hash, K key, V value, HashMap.Node<K,V> next) {
        super(hash, key, value, next);
    }
}
```

å…³äºåŒå‘é“¾è¡¨ï¼ŒåŒå­¦ä»¬å¯ä»¥å›å¤´çœ‹ä¸€éæˆ‘å†™çš„ [LinkedList](https://mp.weixin.qq.com/s/Gr1kXieJoQol2WuFuHWQaA) é‚£ç¯‡æ–‡ç« ï¼Œä¼šå¯¹ç†è§£æœ¬ç¯‡çš„ LinkedHashMap æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

åœ¨ç»§ç»­ä¸‹é¢çš„å†…å®¹ä¹‹å‰ï¼Œæˆ‘å…ˆè´´ä¸€å¼ å›¾ç‰‡ï¼Œç»™å¤§å®¶å¢æ·»ä¸€ç‚¹ä¹è¶£â€”â€”çœ‹æˆ‘è¿™å¿ƒæ“çš„ã€‚ UUID é‚£ç¯‡æ–‡ç« çš„æ ‡é¢˜é‡Œç”¨äº†â€œå¯ç¬‘â€å’Œâ€œä½ â€ï¼Œç»“æœå°±çœ‹åˆ°äº†ä¸‹é¢è¿™ä¹ˆä¹å‘µçš„ç•™è¨€ã€‚


![](http://www.itwanger.com/assets/images/2020/08/java-linked-hashmap-01.png)

ï¼ˆåˆ°åº•æ˜¯çŸ¥é“è¿˜æ˜¯ä¸çŸ¥é“ï¼Œæˆ‘æä¸æ¸…æ¥šäº†ã€‚ã€‚ã€‚ï¼‰é‚£ LinkedHashMap è¿™ç¯‡ä¹Ÿç”¨äº†â€œä½ â€å’Œâ€œå¯ç¬‘â€ï¼Œä¸çŸ¥é“åˆ°æ—¶å€™ä¼šä¸ä¼šæœ‰äººç»§ç»­å¯¹å·å…¥åº§å•Šï¼Œæƒ³æƒ³å°±è§‰å¾—ç‰¹åˆ«æ¬¢ä¹ã€‚

### 01ã€æ’å…¥é¡ºåº

åœ¨ [HashMap](https://mp.weixin.qq.com/s/VLf3bNKB_s2CImsVItxuRw) é‚£ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘æœ‰è®²è§£åˆ°ä¸€ç‚¹ï¼Œä¸çŸ¥é“åŒå­¦ä»¬è®°ä¸è®°å¾—ï¼Œå°±æ˜¯ null ä¼šæ’å…¥åˆ° HashMap çš„ç¬¬ä¸€ä½ã€‚

```java
Map<String, String> hashMap = new HashMap<>();
hashMap.put("æ²‰", "æ²‰é»˜ç‹äºŒ");
hashMap.put("é»˜", "æ²‰é»˜ç‹äºŒ");
hashMap.put("ç‹", "æ²‰é»˜ç‹äºŒ");
hashMap.put("äºŒ", "æ²‰é»˜ç‹äºŒ");
hashMap.put(null, null);

for (String key : hashMap.keySet()) {
    System.out.println(key + " : " + hashMap.get(key));
}
```

è¾“å‡ºçš„ç»“æœæ˜¯ï¼š

```
null : null
é»˜ : æ²‰é»˜ç‹äºŒ
æ²‰ : æ²‰é»˜ç‹äºŒ
ç‹ : æ²‰é»˜ç‹äºŒ
äºŒ : æ²‰é»˜ç‹äºŒ
```

è™½ç„¶ null æœ€åä¸€ä½ put è¿›å»çš„ï¼Œä½†åœ¨éå†è¾“å‡ºçš„æ—¶å€™ï¼Œè·‘åˆ°äº†ç¬¬ä¸€ä½ã€‚

é‚£å†æ¥å¯¹æ¯”çœ‹ä¸€ä¸‹ LinkedHashMapã€‚

```java
Map<String, String> linkedHashMap = new LinkedHashMap<>();
linkedHashMap.put("æ²‰", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("é»˜", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("ç‹", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("äºŒ", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put(null, null);

for (String key : linkedHashMap.keySet()) {
    System.out.println(key + " : " + linkedHashMap.get(key));
}
```

è¾“å‡ºç»“æœæ˜¯ï¼š

```
æ²‰ : æ²‰é»˜ç‹äºŒ
é»˜ : æ²‰é»˜ç‹äºŒ
ç‹ : æ²‰é»˜ç‹äºŒ
äºŒ : æ²‰é»˜ç‹äºŒ
null : null
```

null åœ¨æœ€åä¸€ä½æ’å…¥ï¼Œåœ¨æœ€åä¸€ä½è¾“å‡ºã€‚

è¾“å‡ºç»“æœå¯ä»¥å†æ¬¡è¯æ˜ï¼ŒHashMap æ˜¯æ— åºçš„ï¼ŒLinkedHashMap æ˜¯å¯ä»¥ç»´æŒæ’å…¥é¡ºåºçš„ã€‚

é‚£ LinkedHashMap æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿæˆ‘ç›¸ä¿¡åŒå­¦ä»¬å’Œæˆ‘ä¸€æ ·ï¼Œéå¸¸å¸Œæœ›çŸ¥é“åŸå› ã€‚

è¦æƒ³ææ¸…æ¥šï¼Œå°±éœ€è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹ LinkedHashMap çš„æºç ã€‚LinkedHashMap å¹¶æœªé‡å†™ HashMap çš„ `put()` æ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™äº† `put()` æ–¹æ³•éœ€è¦è°ƒç”¨çš„å†…éƒ¨æ–¹æ³• `newNode()`ã€‚

```java
HashMap.Node<K,V> newNode(int hash, K key, V value, HashMap.Node<K,V> e) {
    LinkedHashMap.Entry<K,V> p =
            new LinkedHashMap.Entry<>(hash, key, value, e);
    linkNodeLast(p);
    return p;
}
```

å‰é¢è¯´äº†ï¼ŒLinkedHashMap.Entry ç»§æ‰¿äº† HashMap.Nodeï¼Œå¹¶ä¸”è¿½åŠ äº†ä¸¤ä¸ªå­—æ®µ before å’Œ afterã€‚

é‚£ï¼Œç´§æ¥ç€æ¥çœ‹çœ‹ `linkNodeLast()` æ–¹æ³•ï¼š

```java
private void linkNodeLast(LinkedHashMap.Entry<K,V> p) {
    LinkedHashMap.Entry<K,V> last = tail;
    tail = p;
    if (last == null)
        head = p;
    else {
        p.before = last;
        last.after = p;
    }
}
```

çœ‹åˆ°äº†å§ï¼ŒLinkedHashMap åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¼šæŠŠ head èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç­‰åˆ°ç¬¬äºŒä¸ªå…ƒç´ æ·»åŠ è¿›æ¥çš„æ—¶å€™ï¼Œä¼šæŠŠç¬¬äºŒä¸ªå…ƒç´ çš„ before èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ afer èµ‹å€¼ä¸ºç¬¬äºŒä¸ªå…ƒç´ ã€‚

è¿™å°±ä¿è¯äº†é”®å€¼å¯¹æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæ’åˆ—çš„ï¼Œæ˜ç™½äº†å§ï¼Ÿ

*æ³¨ï¼šæˆ‘ç”¨åˆ°çš„ JDK ç‰ˆæœ¬ä¸º 14*ã€‚

### 02ã€è®¿é—®é¡ºåº

LinkedHashMap ä¸ä»…èƒ½å¤Ÿç»´æŒæ’å…¥é¡ºåºï¼Œè¿˜èƒ½å¤Ÿç»´æŒè®¿é—®é¡ºåºã€‚è®¿é—®åŒ…æ‹¬è°ƒç”¨ `get()` æ–¹æ³•ã€`remove()` æ–¹æ³•å’Œ `put()` æ–¹æ³•ã€‚

è¦ç»´æŠ¤è®¿é—®é¡ºåºï¼Œéœ€è¦æˆ‘ä»¬åœ¨å£°æ˜ LinkedHashMap çš„æ—¶å€™æŒ‡å®šä¸‰ä¸ªå‚æ•°ã€‚

```java
LinkedHashMap<String, String> map = new LinkedHashMap<>(16, .75f, true);
```

ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œçœ‹è¿‡ [HashMap](https://mp.weixin.qq.com/s/VLf3bNKB_s2CImsVItxuRw) çš„åŒå­¦ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼ŒæŒ‡çš„æ˜¯åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚

ç¬¬ä¸‰ä¸ªå‚æ•°å¦‚æœä¸º true çš„è¯ï¼Œå°±è¡¨ç¤º LinkedHashMap è¦ç»´æŠ¤è®¿é—®é¡ºåºï¼›å¦åˆ™ï¼Œç»´æŠ¤æ’å…¥é¡ºåºã€‚é»˜è®¤æ˜¯ falseã€‚

```java
Map<String, String> linkedHashMap = new LinkedHashMap<>(16, .75f, true);
linkedHashMap.put("æ²‰", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("é»˜", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("ç‹", "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("äºŒ", "æ²‰é»˜ç‹äºŒ");

System.out.println(linkedHashMap);

linkedHashMap.get("é»˜");
System.out.println(linkedHashMap);

linkedHashMap.get("ç‹");
System.out.println(linkedHashMap);
```

è¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{æ²‰=æ²‰é»˜ç‹äºŒ, é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ}
{æ²‰=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, é»˜=æ²‰é»˜ç‹äºŒ}
{æ²‰=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ}
```

å½“æˆ‘ä»¬ä½¿ç”¨ `get()` æ–¹æ³•è®¿é—®é”®ä½â€œé»˜â€çš„å…ƒç´ åï¼Œè¾“å‡ºç»“æœä¸­ï¼Œ`é»˜=æ²‰é»˜ç‹äºŒ` åœ¨æœ€åï¼›å½“æˆ‘ä»¬è®¿é—®é”®ä½â€œç‹â€çš„å…ƒç´ åï¼Œè¾“å‡ºç»“æœä¸­ï¼Œ`ç‹=æ²‰é»˜ç‹äºŒ` åœ¨æœ€åï¼Œ`é»˜=æ²‰é»˜ç‹äºŒ` åœ¨å€’æ•°ç¬¬äºŒä½ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ä¸ç»å¸¸è®¿é—®çš„æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™å°±æœ‰æ„æ€äº†ã€‚æœ‰æ„æ€åœ¨å“ªå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LinkedHashMap æ¥å®ç° LRU ç¼“å­˜ï¼ŒLRU æ˜¯ Least Recently Used çš„ç¼©å†™ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼Œé€‰æ‹©æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚



```java
public class MyLinkedHashMap<K, V> extends LinkedHashMap<K, V> {

    private static final int MAX_ENTRIES = 5;

    public MyLinkedHashMap(
            int initialCapacity, float loadFactor, boolean accessOrder) {
        super(initialCapacity, loadFactor, accessOrder);
    }

    @Override
    protected boolean removeEldestEntry(Map.Entry eldest) {
        return size() > MAX_ENTRIES;
    }

}
``` 

MyLinkedHashMap æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œå®ƒç»§æ‰¿äº† LinkedHashMapï¼Œå¹¶ä¸”é‡å†™äº† `removeEldestEntry()` æ–¹æ³•â€”â€”ä½¿ Map æœ€å¤šå¯å®¹çº³ 5 ä¸ªå…ƒç´ ï¼Œè¶…å‡ºåå°±æ·˜æ±°ã€‚

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚

```java
MyLinkedHashMap<String,String> map = new MyLinkedHashMap<>(16,0.75f,true);
map.put("æ²‰", "æ²‰é»˜ç‹äºŒ");
map.put("é»˜", "æ²‰é»˜ç‹äºŒ");
map.put("ç‹", "æ²‰é»˜ç‹äºŒ");
map.put("äºŒ", "æ²‰é»˜ç‹äºŒ");
map.put("ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");

System.out.println(map);

map.put("ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜", "ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜");
System.out.println(map);

map.put("ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜","ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜");
System.out.println(map);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{æ²‰=æ²‰é»˜ç‹äºŒ, é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜}
{é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜, ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜}
{ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜, ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜, ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜=ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜}
```

`æ²‰=æ²‰é»˜ç‹äºŒ` å’Œ `é»˜=æ²‰é»˜ç‹äºŒ` ä¾æ¬¡è¢«æ·˜æ±°å‡ºå±€ã€‚

å‡å¦‚åœ¨ put â€œä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜â€ä¹‹å‰ get äº†é”®ä½ä¸ºâ€œé»˜â€çš„å…ƒç´ ï¼š

```java
MyLinkedHashMap<String,String> map = new MyLinkedHashMap<>(16,0.75f,true);
map.put("æ²‰", "æ²‰é»˜ç‹äºŒ");
map.put("é»˜", "æ²‰é»˜ç‹äºŒ");
map.put("ç‹", "æ²‰é»˜ç‹äºŒ");
map.put("äºŒ", "æ²‰é»˜ç‹äºŒ");
map.put("ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");

System.out.println(map);

map.put("ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜", "ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜");
System.out.println(map);

map.get("é»˜");
map.put("ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜","ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜");
System.out.println(map);
```

é‚£è¾“å‡ºç»“æœå°±å˜äº†ï¼Œå¯¹å§ï¼Ÿ

```
{æ²‰=æ²‰é»˜ç‹äºŒ, é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜}
{é»˜=æ²‰é»˜ç‹äºŒ, ç‹=æ²‰é»˜ç‹äºŒ, äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜, ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜}
{äºŒ=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜, ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜, é»˜=æ²‰é»˜ç‹äºŒ, ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜=ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜}
```

`æ²‰=æ²‰é»˜ç‹äºŒ` å’Œ `ç‹=æ²‰é»˜ç‹äºŒ` è¢«æ·˜æ±°å‡ºå±€äº†ã€‚

é‚£ LinkedHashMap æ˜¯å¦‚ä½•æ¥ç»´æŒè®¿é—®é¡ºåºå‘¢ï¼ŸåŒå­¦ä»¬æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç ”ç©¶ä¸€ä¸‹ä¸‹é¢è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚

```java
void afterNodeAccess(Node<K,V> p) { }
void afterNodeInsertion(boolean evict) { }
void afterNodeRemoval(Node<K,V> p) { }
```

`afterNodeAccess()` ä¼šåœ¨è°ƒç”¨ `get()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ`afterNodeInsertion()` ä¼šåœ¨è°ƒç”¨ `put()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ`afterNodeRemoval()` ä¼šåœ¨è°ƒç”¨ `remove()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ã€‚

æˆ‘æ¥ä»¥ `afterNodeAccess()` ä¸ºä¾‹æ¥è®²è§£ä¸€ä¸‹ã€‚

```java
void afterNodeAccess(HashMap.Node<K,V> e) { // move node to last
    LinkedHashMap.Entry<K,V> last;
    if (accessOrder && (last = tail) != e) {
        LinkedHashMap.Entry<K,V> p =
                (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;
        p.after = null;
        if (b == null)
            head = a;
        else
            b.after = a;
        if (a != null)
            a.before = b;
        else
            last = b;
        if (last == null)
            head = p;
        else {
            p.before = last;
            last.after = p;
        }
        tail = p;
        ++modCount;
    }
}
```

å“ªä¸ªå…ƒç´ è¢« get å°±æŠŠå“ªä¸ªå…ƒç´ æ”¾åœ¨æœ€åã€‚äº†è§£äº†å§ï¼Ÿ

é‚£åŒå­¦ä»¬å¯èƒ½è¿˜æƒ³çŸ¥é“ï¼Œä¸ºä»€ä¹ˆ LinkedHashMap èƒ½å®ç°  LRU ç¼“å­˜ï¼ŒæŠŠæœ€ä¸ç»å¸¸è®¿é—®çš„é‚£ä¸ªå…ƒç´ æ·˜æ±°ï¼Ÿ

åœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ `put()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ€åä¼šè°ƒç”¨ `afterNodeInsertion()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¢« LinkedHashMap é‡å†™äº†ã€‚

```java
void afterNodeInsertion(boolean evict) { // possibly remove eldest
    LinkedHashMap.Entry<K,V> first;
    if (evict && (first = head) != null && removeEldestEntry(first)) {
        K key = first.key;
        removeNode(hash(key), key, null, false, true);
    }
}
```

`removeEldestEntry()` æ–¹æ³•ä¼šåˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦è¶…å‡ºäº†å¯å®¹çº³çš„æœ€å¤§èŒƒå›´ï¼Œå¦‚æœè¶…å‡ºï¼Œé‚£å°±ä¼šè°ƒç”¨ `removeNode()` æ–¹æ³•å¯¹æœ€ä¸ç»å¸¸è®¿é—®çš„é‚£ä¸ªå…ƒç´ è¿›è¡Œåˆ é™¤ã€‚

### 03ã€æœ€å

ç”±äº LinkedHashMap è¦ç»´æŠ¤åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥ LinkedHashMap åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶å€™ï¼ŒèŠ±è´¹çš„æ—¶é—´è¦æ¯” HashMap å¤šä¸€äº›ã€‚

è¿™ä¹Ÿæ˜¯æ²¡åŠæ³•çš„äº‹ï¼Œå¯¹å§ï¼Œæ¬²æˆ´çš‡å† å¿…æ‰¿å…¶é‡å˜›ã€‚æ—¢ç„¶æƒ³è¦ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œæ€»è¦ä»˜å‡ºç‚¹ä»£ä»·æ‰è¡Œã€‚


![](http://www.itwanger.com/assets/images/2020/08/java-linked-hashmap-02.png)

é‚£è¿™ç¯‡æ–‡ç« å°±åˆ°æ­¤æˆ›ç„¶è€Œæ­¢äº†ï¼ŒåŒå­¦ä»¬è¦è§‰å¾—æ„çŠ¹æœªå°½ï¼Œè¯·è‚†æ— å¿Œæƒ®åœ°ç•™è¨€å‘Šè¯‰æˆ‘å“¦ã€‚ï¼ˆä¸€ä¸å°å¿ƒåˆåœ¨æ–‡æœ«ç”©ä»¨æˆè¯­ï¼Œæœ‰ç‚¹æ–‡åŒ–åº•è•´ï¼Œå¯¹å§ï¼Ÿï¼‰

-----

æˆ‘æ˜¯æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰é¢œå€¼å´å‡è£…é æ‰åè‹Ÿä¸”çš„ç¨‹åºå‘˜ã€‚**å…³æ³¨å³å¯æå‡å­¦ä¹ æ•ˆç‡ï¼Œåˆ«å¿˜äº†ä¸‰è¿å•Šï¼Œç‚¹èµã€æ”¶è—ã€ç•™è¨€ï¼Œæˆ‘ä¸æŒ‘ï¼Œå¥¥åˆ©ç»™ğŸŒ¹**ã€‚

æ³¨ï¼šå¦‚æœæ–‡ç« æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æ¯«ä¸ç•™æƒ…åœ°æŒ‡æ­£ã€‚

å¦‚æœä½ è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰äº›å¸®åŠ©ï¼Œæ¬¢è¿å¾®ä¿¡æœç´¢ã€Œ**æ²‰é»˜ç‹äºŒ**ã€ç¬¬ä¸€æ—¶é—´é˜…è¯»ï¼Œå›å¤å…³é”®å­—ã€Œ**å°ç™½**ã€å¯ä»¥å…è´¹è·å–æˆ‘è‚äº† 4 ä¸‡+å­—çš„ ã€ŠJava å°ç™½ä»å…¥é—¨åˆ°æ”¾è‚†ã€‹2.0 ç‰ˆï¼›æœ¬æ–‡Â **GitHub**Â [github.com/itwanger](https://github.com/itwanger/itwanger.github.io)Â å·²æ”¶å½•ï¼Œæ¬¢è¿ starã€‚